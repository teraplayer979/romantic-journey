<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Choosing You</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Inter:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- RESET & VARIABLES --- */
        :root {
            --bg-deep: #0f172a;
            --rose-primary: #e11d48;
            --rose-soft: #fda4af;
            --violet-haze: #4c1d95;
            --glass-surface: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-main: #f8fafc;
            --text-muted: #cbd5e1;
            
            --font-display: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
            --font-script: 'Dancing Script', cursive;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-deep);
            background-image: linear-gradient(to bottom right, #1e1b4b, #311726, #4c0519);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: var(--font-body);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            touch-action: none; /* Prevent default scroll */
        }

        /* --- BACKGROUND PARTICLES --- */
        #particle-canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        /* --- HEADER --- */
        .header {
            position: absolute;
            top: 8%;
            text-align: center;
            z-index: 20;
            width: 100%;
            padding: 0 20px;
            pointer-events: none;
        }

        .title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            opacity: 0;
            animation: fadeDown 1s ease forwards 0.5s;
        }

        .subtitle {
            font-family: var(--font-body);
            font-size: 0.9rem;
            color: var(--rose-soft);
            opacity: 0;
            animation: fadeDown 1s ease forwards 0.8s;
        }

        /* --- CARD STACK --- */
        .stack-container {
            position: relative;
            width: 320px;
            height: 480px;
            z-index: 10;
            perspective: 1000px;
        }

        .swipe-card {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--glass-surface);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            transform-origin: 50% 100%;
            will-change: transform, opacity;
            display: flex;
            flex-direction: column;
            /* Default stack positioning handled by JS */
        }

        .card-image {
            width: 100%;
            height: 75%;
            object-fit: cover;
            pointer-events: none;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .card-content {
            flex-grow: 1;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.6));
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
        }

        .card-caption {
            font-family: var(--font-display);
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: #fff;
        }

        .card-sub {
            font-family: var(--font-body);
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
        }

        /* Overlays for Swipe Feedback */
        .overlay-choice {
            position: absolute;
            top: 40px;
            padding: 10px 20px;
            border: 3px solid;
            border-radius: 10px;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0;
            transform: rotate(-15deg);
            z-index: 5;
        }

        .choice-like {
            right: 40px;
            border-color: #4ade80; /* Green */
            color: #4ade80;
            transform: rotate(15deg);
        }

        .choice-nope {
            left: 40px;
            border-color: #f43f5e; /* Red */
            color: #f43f5e;
        }

        /* --- FINAL CARD (MATCH) --- */
        .final-card-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(20, 10, 30, 0.9);
        }

        .match-avatar {
            width: 100px; height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--rose-primary), var(--violet-haze));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
            box-shadow: 0 0 30px var(--rose-primary);
            animation: pulse 2s infinite;
        }

        .match-title {
            font-family: var(--font-display);
            font-size: 2rem;
            background: linear-gradient(to right, #fff, var(--rose-soft));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .match-text {
            font-family: var(--font-body);
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 30px;
        }

        /* --- ENDING UI --- */
        .ending-container {
            position: absolute;
            bottom: 10%;
            text-align: center;
            width: 100%;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
            z-index: 30;
        }

        .final-msg {
            font-family: var(--font-script);
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--rose-soft);
        }

        .next-btn {
            background: linear-gradient(135deg, var(--rose-primary), #be123c);
            border: none;
            color: white;
            padding: 16px 40px;
            border-radius: 50px;
            font-family: var(--font-body);
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(225, 29, 72, 0.4);
            transition: transform 0.2s;
        }

        .next-btn:hover {
            transform: scale(1.05);
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(225, 29, 72, 0); } 100% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0); } }
        
        .float-heart {
            position: absolute;
            font-size: 2rem;
            color: var(--rose-primary);
            animation: floatUp 1.5s ease-out forwards;
            z-index: 50;
            pointer-events: none;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5) rotate(20deg); opacity: 0; }
        }

    </style>
</head>
<body>

    <canvas id="particle-canvas"></canvas>

    <div class="header">
        <div class="title">If I had to choose again...</div>
        <div class="subtitle">I’d swipe right on you. Every time.</div>
    </div>

    <div class="stack-container" id="stack">
        </div>

    <div class="ending-container" id="endingUI">
        <div class="final-msg">I don’t need any other matches.<br>You’re the only one I’ll ever choose.</div>
        <button class="next-btn" onclick="nextPage()">Continue our journey &rarr;</button>
    </div>

    <script>
        /* --- CARD DATA --- */
        const CARDS = [
            {
                img: "https://images.unsplash.com/photo-1516575334481-f85287c2c81d?auto=format&fit=crop&w=600&q=80",
                title: "First Date",
                caption: "The day my heart chose you."
            },
            {
                img: "https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?auto=format&fit=crop&w=600&q=80",
                title: "Just Laughing",
                caption: "My favorite sound in the world."
            },
            {
                img: "https://images.unsplash.com/photo-1621184455862-c163dfb30e0f?auto=format&fit=crop&w=600&q=80",
                title: "Holding Hands",
                caption: "Where I always belong."
            },
            {
                img: "https://images.unsplash.com/photo-1516726817505-f5ed825624d8?auto=format&fit=crop&w=600&q=80",
                title: "Us",
                caption: "Still my favorite face."
            },
            {
                isFinal: true
            }
        ];

        /* --- VARIABLES --- */
        const stack = document.getElementById('stack');
        const endingUI = document.getElementById('endingUI');
        let cardElements = [];
        let currentIndex = 0;

        /* --- INITIALIZATION --- */
        function createCards() {
            // Create in reverse order so first is on top in DOM (z-index handled by order)
            // Actually, typical stack: last in DOM is on top visually if absolute.
            // Let's create them in order, but use z-index to stack properly.
            
            [...CARDS].reverse().forEach((data, index) => {
                const realIndex = CARDS.length - 1 - index;
                const card = document.createElement('div');
                card.classList.add('swipe-card');
                card.style.zIndex = index; // 0 is bottom, length-1 is top
                
                // Visual offset for stack effect
                if (index < 3) {
                    card.style.top = `${(CARDS.length - 1 - index) * -2}px`;
                    card.style.transform = `scale(${1 - (CARDS.length - 1 - index) * 0.05})`;
                }

                if (data.isFinal) {
                    card.classList.add('final-card');
                    card.innerHTML = `
                        <div class="final-card-content">
                            <div class="match-avatar">❤️</div>
                            <div class="match-title">It's a Match!</div>
                            <div class="match-text">Status: Forever Yours</div>
                        </div>
                    `;
                } else {
                    card.innerHTML = `
                        <img src="${data.img}" class="card-image" alt="Memory">
                        <div class="card-content">
                            <div class="card-caption">${data.title}</div>
                            <div class="card-sub">${data.caption}</div>
                        </div>
                        <div class="overlay-choice choice-like">YES</div>
                        <div class="overlay-choice choice-nope">NO</div>
                    `;
                }

                stack.appendChild(card);
                cardElements.push(card);
            });
            
            // Re-reverse array to match index 0 = top card
            cardElements.reverse();
            
            // Attach listeners to the top card
            attachListeners(cardElements[0]);
        }

        /* --- PHYSICS & INTERACTION --- */
        let isDragging = false;
        let startX = 0;
        let currentX = 0;
        let startY = 0;
        
        function attachListeners(card) {
            if (!card) return;
            
            // Touch
            card.addEventListener('touchstart', onDragStart);
            card.addEventListener('touchmove', onDragMove);
            card.addEventListener('touchend', onDragEnd);
            
            // Mouse
            card.addEventListener('mousedown', onDragStart);
            document.addEventListener('mousemove', onDragMove);
            document.addEventListener('mouseup', onDragEnd);
        }

        function removeListeners(card) {
            if (!card) return;
            card.removeEventListener('touchstart', onDragStart);
            card.removeEventListener('touchmove', onDragMove);
            card.removeEventListener('touchend', onDragEnd);
            card.removeEventListener('mousedown', onDragStart);
        }

        function onDragStart(e) {
            if (currentIndex >= CARDS.length) return; // Finished
            
            // Final card is not swipable
            if (CARDS[currentIndex].isFinal) {
                // Just a little wiggle if they try
                return; 
            }

            isDragging = true;
            startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            
            const card = cardElements[currentIndex];
            card.style.transition = 'none';
        }

        function onDragMove(e) {
            if (!isDragging) return;
            e.preventDefault(); // Stop scroll

            const x = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            const y = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            
            currentX = x - startX;
            const rotate = currentX * 0.1; // Rotate based on drag
            
            const card = cardElements[currentIndex];
            card.style.transform = `translateX(${currentX}px) rotate(${rotate}deg)`;

            // Opacity of overlays
            const likeOpacity = Math.max(0, Math.min(1, currentX / 100));
            const nopeOpacity = Math.max(0, Math.min(1, -currentX / 100));
            
            card.querySelector('.choice-like').style.opacity = likeOpacity;
            card.querySelector('.choice-nope').style.opacity = nopeOpacity;
        }

        function onDragEnd(e) {
            if (!isDragging) return;
            isDragging = false;
            
            const card = cardElements[currentIndex];
            const threshold = 100; // Swipe distance required

            // SWIPE RIGHT (LOVE)
            if (currentX > threshold) {
                dismissCard(1); // 1 = right
            } 
            // SWIPE LEFT (REJECT - BUT RETURNS)
            else if (currentX < -threshold) {
                // Special logic: Fly left, but then return to bottom? 
                // Or just bounce back?
                // Prompt: "floats away and fades, but returns to the stack"
                
                // Let's do a fake-out. Fly away, fade, then snap back to center.
                rejectAndReturn(card);
            } 
            // RESET (Didn't swipe far enough)
            else {
                resetCard(card);
            }
        }

        function dismissCard(direction) {
            const card = cardElements[currentIndex];
            
            card.style.transition = 'transform 0.6s ease-out, opacity 0.6s ease-out';
            card.style.transform = `translateX(${direction * 1000}px) rotate(${direction * 45}deg)`;
            card.style.opacity = '0';
            
            // Spawn hearts if right swipe
            if (direction === 1) {
                spawnHearts();
                if(navigator.vibrate) navigator.vibrate(50);
            }

            // Move to next
            currentIndex++;
            
            if (currentIndex < CARDS.length) {
                const nextCard = cardElements[currentIndex];
                attachListeners(nextCard);
                // Bring next card up
                // (In a real app we'd animate the whole stack up, but CSS defaults handle it well enough here)
                
                // If it's the final card
                if (CARDS[currentIndex].isFinal) {
                    setTimeout(() => {
                        showFinalState();
                    }, 500);
                }
            }
        }

        function rejectAndReturn(card) {
            // Animate out left
            card.style.transition = 'transform 0.5s ease-in, opacity 0.5s';
            card.style.transform = `translateX(-500px) rotate(-30deg)`;
            card.style.opacity = '0';
            
            // Wait, then reset instantly and fade in
            setTimeout(() => {
                card.style.transition = 'none';
                card.style.transform = `scale(0.8)`; // Start small
                
                // Force reflow
                card.offsetHeight;
                
                card.style.transition = 'transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s';
                card.style.transform = `scale(1) translateX(0) rotate(0)`;
                card.style.opacity = '1';
                
                // Reset overlays
                card.querySelector('.choice-like').style.opacity = 0;
                card.querySelector('.choice-nope').style.opacity = 0;
                
                // Shake slightly to say "No, pick me!"
                if(navigator.vibrate) navigator.vibrate([20, 50, 20]);
                
            }, 500);
        }

        function resetCard(card) {
            card.style.transition = 'transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            card.style.transform = `translateX(0) rotate(0)`;
            card.querySelector('.choice-like').style.opacity = 0;
            card.querySelector('.choice-nope').style.opacity = 0;
        }

        function spawnHearts() {
            for(let i=0; i<10; i++) {
                const heart = document.createElement('div');
                heart.classList.add('float-heart');
                heart.innerHTML = '❤️';
                heart.style.left = (Math.random() * 80 + 10) + '%';
                heart.style.top = '50%';
                heart.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 2000);
            }
        }

        function showFinalState() {
            // Haptic Boom
            if(navigator.vibrate) navigator.vibrate([50, 100, 50]);
            
            setTimeout(() => {
                endingUI.style.opacity = 1;
                endingUI.style.pointerEvents = 'auto';
            }, 1000);
        }

        /* --- BACKGROUND PARTICLES --- */
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];

        function initParticles() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            particles = [];
            for(let i=0; i<40; i++) {
                particles.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    r: Math.random() * 2,
                    speedY: Math.random() * 0.5 + 0.1,
                    opacity: Math.random()
                });
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
            particles.forEach(p => {
                p.y -= p.speedY;
                if(p.y < 0) p.y = height;
                ctx.globalAlpha = p.opacity;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                ctx.fill();
            });
            requestAnimationFrame(animateParticles);
        }

        window.addEventListener('resize', initParticles);
        initParticles();
        animateParticles();
        createCards();

        /* --- NAVIGATION --- */
        function nextPage() {
            document.body.style.transition = "opacity 1.5s ease";
            document.body.style.opacity = 0;
            setTimeout(() => {
                window.location.href = "boarding_pass_to_forever.html";
            }, 1500);
        }

    </script>

</body>
</html>
